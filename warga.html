<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIPW | Data Warga</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.12);
            --border: rgba(255, 255, 255, 0.2);
            --primary-green: #2d5a27;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), 
                        url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1932&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover; color: white; min-height: 100vh; margin: 0;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(45, 90, 39, 0.95); backdrop-filter: blur(20px);
            border-right: 1px solid var(--border); height: 100vh; padding: 30px 20px;
            position: fixed; width: 260px; display: flex; flex-direction: column;
            z-index: 1100; transition: 0.3s;
        }

        .main-content { margin-left: 260px; padding: 40px; transition: 0.3s; }

        /* Hamburger Sticky */
        .btn-hamburger {
            display: none; position: fixed; top: 20px; left: 20px; z-index: 1200;
            background: var(--primary-green); color: white; border: none;
            padding: 12px 15px; border-radius: 10px; transition: all 0.3s ease;
        }
        .btn-hamburger.scrolled {
            top: 10px; left: 10px; padding: 8px 12px;
            background: rgba(45, 90, 39, 0.6); backdrop-filter: blur(10px);
            transform: scale(0.85);
        }

        /* Floating Button Tambah */
        .btn-add-floating {
            position: fixed; bottom: 30px; right: 20px; z-index: 1000;
            background: #76ff03; color: #000; font-weight: 700;
            border-radius: 50px; padding: 12px 20px; border: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4); transition: 0.3s;
        }

        .nav-link {
            color: rgba(255,255,255,0.8); padding: 12px 20px; border-radius: 12px;
            margin-bottom: 10px; text-decoration: none; display: flex; align-items: center;
        }
        .nav-link:hover, .nav-link.active { background: white; color: var(--primary-green) !important; font-weight: 600; }

        .btn-logout {
            width: 100%; background: rgba(220, 53, 69, 0.2); border: 1px solid #dc3545;
            color: #ff6b6b; padding: 12px; border-radius: 12px; text-align: center; font-weight: 600; text-decoration: none; display: block;
        }

        .glass-card {
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid var(--border); border-radius: 20px; padding: 25px;
        }

        /* Input Fix: Tulisan Gelap saat Fokus */
        .form-control {
            background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            color: white !important; border-radius: 10px; padding: 10px;
        }
        .form-control:focus {
            background: rgba(255, 255, 255, 0.95) !important;
            color: #1a2a1a !important; /* Tulisan jadi gelap saat diketik */
            box-shadow: none; border-color: #76ff03;
        }

        .table { color: white !important; min-width: 700px; }

        /* Modal Responsif */
        .modal-content { 
            background: rgba(15, 30, 15, 0.98); backdrop-filter: blur(25px); 
            border-radius: 25px; border: 1px solid var(--border); color: white;
        }
        
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .btn-hamburger { display: block; top: 25px; }
            .main-content { margin-left: 0; padding: 20px; padding-top: 25px; }
            .main-title { text-align: right; font-size: 1.6rem; padding-left: 60px; margin-bottom: 40px !important; }

            /* Modal Mobile diperkecil */
            .modal-dialog { max-width: 330px; margin: 1.75rem auto; }
            .modal-content { transform: scale(0.95); }
            .btn-add-floating { bottom: 20px; right: 15px; font-size: 0.85rem; padding: 10px 15px; }
        }
    </style>
</head>
<body>

<button class="btn-hamburger shadow" id="hamburgerBtn" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
</button>

<div class="sidebar" id="sidebar">
    <h3 class="fw-bold mb-5 text-center text-success">SIP<span class="text-white">W</span></h3>
    <nav>
        <a href="admin.html" class="nav-link"><i class="fas fa-chart-pie me-3"></i> Ringkasan</a>
        <a href="survei.html" class="nav-link"><i class="fas fa-user-shield me-3"></i> Petugas</a>
        <a href="data-warga.html" class="nav-link active"><i class="fas fa-users me-3"></i> Data Warga</a>
    </nav>
    <div style="margin-top: auto; padding-top: 20px;">
        <a href="index.html" class="btn-logout">KELUAR</a>
    </div>
</div>

<div class="main-content">
    <h2 class="fw-bold main-title mb-4">Manajemen Data Warga</h2>

    <div class="glass-card">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr class="opacity-50 small">
                        <th>NIK</th>
                        <th>NAMA LENGKAP</th>
                        <th>ALAMAT</th>
                        <th>NO. HP</th>
                        <th class="text-center">AKSI</th>
                    </tr>
                </thead>
                <tbody id="tabelWarga"></tbody>
            </table>
        </div>
    </div>
</div>

<button class="btn-add-floating shadow" data-bs-toggle="modal" data-bs-target="#modalWarga" onclick="resetForm()">
    <i class="fas fa-plus me-2"></i> TAMBAH WARGA
</button>

<div class="modal fade" id="modalWarga" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-2">
            <div class="modal-header border-0 pb-0">
                <h6 class="modal-title fw-bold">Data Warga</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form id="formWarga" onsubmit="simpanWarga(event)">
                <div class="modal-body py-2">
                    <input type="hidden" id="wargaId">
                    <div class="mb-2">
                        <label class="small opacity-75 mb-1">NIK</label>
                        <input type="text" id="nik" class="form-control" placeholder="NIK" required>
                    </div>
                    <div class="mb-2">
                        <label class="small opacity-75 mb-1">Nama Lengkap</label>
                        <input type="text" id="nama" class="form-control" placeholder="Nama Lengkap" required>
                    </div>
                    <div class="mb-2">
                        <label class="small opacity-75 mb-1">Alamat</label>
                        <input type="text" id="alamat" class="form-control" placeholder="Alamat" required>
                    </div>
                    <div class="mb-3">
                        <label class="small opacity-75 mb-1">WhatsApp</label>
                        <input type="text" id="hp" class="form-control" placeholder="0812..." required>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0 gap-2">
                    <button type="button" class="btn btn-sm btn-outline-light px-3" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-sm btn-success px-4 fw-bold">SIMPAN</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Scroll Hamburger
    window.onscroll = function() {
        const btn = document.getElementById("hamburgerBtn");
        if (document.body.scrollTop > 50 || document.documentElement.scrollTop > 50) {
            btn.classList.add("scrolled");
        } else {
            btn.classList.remove("scrolled");
        }
    };

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('active');
    }

    const dataDefault = [
        { nik: "3513012345670001", nama: "Zakil Amin", alamat: "Dusun Krajan RT 01", hp: "081234567890" },
        { nik: "3513012345670002", nama: "Siti Aminah", alamat: "Curah Tengah RT 05", hp: "085298765432" },
        { nik: "3513012345670003", nama: "Budi Santoso", alamat: "Jalan Melati No. 12", hp: "082112233445" }
    ];

    let wargaData = JSON.parse(localStorage.getItem('db_warga')) || dataDefault;
    if (!localStorage.getItem('db_warga')) localStorage.setItem('db_warga', JSON.stringify(wargaData));

    function tampilkanData() {
        const tabel = document.getElementById('tabelWarga');
        tabel.innerHTML = '';
        wargaData.forEach((w, index) => {
            tabel.innerHTML += `
                <tr>
                    <td class="small">${w.nik}</td>
                    <td class="fw-bold">${w.nama}</td>
                    <td>${w.alamat}</td>
                    <td>${w.hp}</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-info me-1" onclick="editWarga(${index})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="hapusWarga(${index})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
        });
    }

    function simpanWarga(e) {
        e.preventDefault();
        const id = document.getElementById('wargaId').value;
        const baru = {
            nik: document.getElementById('nik').value,
            nama: document.getElementById('nama').value,
            alamat: document.getElementById('alamat').value,
            hp: document.getElementById('hp').value
        };
        if (id === "") wargaData.push(baru);
        else wargaData[id] = baru;
        localStorage.setItem('db_warga', JSON.stringify(wargaData));
        bootstrap.Modal.getInstance(document.getElementById('modalWarga')).hide();
        tampilkanData();
    }

    function editWarga(index) {
        const w = wargaData[index];
        document.getElementById('wargaId').value = index;
        document.getElementById('nik').value = w.nik;
        document.getElementById('nama').value = w.nama;
        document.getElementById('alamat').value = w.alamat;
        document.getElementById('hp').value = w.hp;
        new bootstrap.Modal(document.getElementById('modalWarga')).show();
    }

    function hapusWarga(index) {
        if(confirm('Hapus data warga ini?')) {
            wargaData.splice(index, 1);
            localStorage.setItem('db_warga', JSON.stringify(wargaData));
            tampilkanData();
        }
    }

    function resetForm() {
        document.getElementById('formWarga').reset();
        document.getElementById('wargaId').value = "";
    }

    window.onload = tampilkanData;
</script>
</body>
</html>